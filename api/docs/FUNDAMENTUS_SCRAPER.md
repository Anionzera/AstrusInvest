# üìä Webscraper do Fundamentus - Documenta√ß√£o Completa

## üéØ Vis√£o Geral

O **Fundamentus Scraper** √© uma solu√ß√£o completa para extrair dados fundamentalistas de a√ß√µes brasileiras diretamente do site [Fundamentus.com.br](https://www.fundamentus.com.br). Esta implementa√ß√£o oferece tanto acesso direto via Python quanto uma API REST completa para integra√ß√£o com aplica√ß√µes web.

### üöÄ Caracter√≠sticas Principais

- ‚úÖ **Extra√ß√£o Completa**: Todos os indicadores fundamentalistas dispon√≠veis
- ‚úÖ **API REST**: Endpoints organizados e documentados
- ‚úÖ **An√°lise Setorial**: Estat√≠sticas por setor de atua√ß√£o
- ‚úÖ **Busca por Crit√©rios**: Filtros avan√ßados para screening de a√ß√µes
- ‚úÖ **Compara√ß√£o de A√ß√µes**: An√°lise comparativa entre m√∫ltiplas empresas
- ‚úÖ **Rankings**: Classifica√ß√£o por indicadores espec√≠ficos
- ‚úÖ **Cache Inteligente**: Otimiza√ß√£o de performance
- ‚úÖ **Tratamento de Erros**: Robustez e confiabilidade
- ‚úÖ **Logs Detalhados**: Monitoramento e debugging

## üìã Dados Extra√≠dos

### üìà Informa√ß√µes B√°sicas
- **Papel**: C√≥digo da a√ß√£o
- **Tipo**: Tipo de papel (PN, ON, etc.)
- **Empresa**: Nome da empresa
- **Setor**: Setor de atua√ß√£o
- **Subsetor**: Subsetor espec√≠fico

### üí∞ Cota√ß√£o e Mercado
- **Cota√ß√£o**: Pre√ßo atual da a√ß√£o
- **Data da √öltima Cota√ß√£o**: Data da √∫ltima atualiza√ß√£o
- **M√≠nima 52 semanas**: Menor pre√ßo em 52 semanas
- **M√°xima 52 semanas**: Maior pre√ßo em 52 semanas
- **Volume M√©dio (2m)**: Volume m√©dio de negocia√ß√£o
- **Valor de Mercado**: Capitaliza√ß√£o de mercado
- **Valor da Firma**: Enterprise Value
- **N√∫mero de A√ß√µes**: Quantidade de a√ß√µes em circula√ß√£o

### üìä Oscila√ß√µes
- **Dia**: Varia√ß√£o no dia (%)
- **M√™s**: Varia√ß√£o no m√™s (%)
- **30 dias**: Varia√ß√£o em 30 dias (%)
- **12 meses**: Varia√ß√£o em 12 meses (%)
- **Anos anteriores**: Varia√ß√£o anual (2020-2025)

### üîç Indicadores Fundamentalistas
- **P/L**: Pre√ßo/Lucro
- **P/VP**: Pre√ßo/Valor Patrimonial
- **P/EBIT**: Pre√ßo/EBIT
- **PSR**: Price-to-Sales Ratio
- **P/Ativos**: Pre√ßo/Ativos
- **P/Cap. Giro**: Pre√ßo/Capital de Giro
- **P/Ativ Circ Liq**: Pre√ßo/Ativo Circulante L√≠quido
- **Div. Yield**: Dividend Yield (%)
- **EV/EBITDA**: Enterprise Value/EBITDA
- **EV/EBIT**: Enterprise Value/EBIT
- **Cres. Rec (5a)**: Crescimento da Receita em 5 anos (%)

### üíº Indicadores de Efici√™ncia
- **LPA**: Lucro Por A√ß√£o
- **VPA**: Valor Patrimonial por A√ß√£o
- **Marg. Bruta**: Margem Bruta (%)
- **Marg. EBIT**: Margem EBIT (%)
- **Marg. L√≠quida**: Margem L√≠quida (%)
- **EBIT/Ativo**: EBIT sobre Ativo (%)
- **ROIC**: Return on Invested Capital (%)
- **ROE**: Return on Equity (%)
- **Liquidez Corr**: Liquidez Corrente
- **Div Br/Patrim**: D√≠vida Bruta sobre Patrim√¥nio
- **Giro Ativos**: Giro dos Ativos

### üè¶ Balan√ßo Patrimonial
- **Ativo**: Ativo Total
- **Disponibilidades**: Caixa e Equivalentes
- **Ativo Circulante**: Ativo Circulante
- **D√≠vida Bruta**: D√≠vida Bruta Total
- **D√≠vida L√≠quida**: D√≠vida L√≠quida
- **Patrim√¥nio L√≠quido**: Patrim√¥nio L√≠quido

### üìà Demonstrativos de Resultados
#### √öltimos 12 Meses
- **Receita L√≠quida**: Receita L√≠quida
- **EBIT**: Earnings Before Interest and Taxes
- **Lucro L√≠quido**: Lucro L√≠quido

#### √öltimos 3 Meses
- **Receita L√≠quida (3m)**: Receita L√≠quida Trimestral
- **EBIT (3m)**: EBIT Trimestral
- **Lucro L√≠quido (3m)**: Lucro L√≠quido Trimestral

## üõ†Ô∏è Instala√ß√£o e Configura√ß√£o

### üì¶ Depend√™ncias

```bash
pip install beautifulsoup4==4.12.3
pip install lxml==5.1.0
pip install html5lib==1.1
pip install pandas==2.2.3
pip install requests==2.31.0
pip install flask==2.3.3
pip install flask-cors==5.0.1
```

### üîß Configura√ß√£o

1. **Instalar depend√™ncias**:
```bash
cd api
pip install -r requirements.txt
```

2. **Iniciar o servidor**:
```bash
python app.py
```

3. **Verificar funcionamento**:
```bash
curl http://localhost:5000/api/fundamentus/health
```

## üîå API REST - Endpoints

### üè• Health Check

**GET** `/api/fundamentus/health`

Verifica se o servi√ßo est√° funcionando.

```bash
curl http://localhost:5000/api/fundamentus/health
```

**Resposta**:
```json
{
  "status": "healthy",
  "message": "Servi√ßo do Fundamentus est√° funcionando normalmente",
  "timestamp": "2025-01-27T10:30:00",
  "service": "Fundamentus Scraper"
}
```

### üìä Dados de A√ß√£o Espec√≠fica

**GET** `/api/fundamentus/stock/{symbol}`

Obt√©m dados fundamentalistas completos de uma a√ß√£o.

```bash
curl http://localhost:5000/api/fundamentus/stock/PETR4
```

**Resposta**:
```json
{
  "success": true,
  "symbol": "PETR4",
  "timestamp": "2025-01-27T10:30:00",
  "source": "Fundamentus",
  "data": {
    "papel": "PETR4",
    "tipo": "PN",
    "empresa": "PETROBRAS PN",
    "setor": "Petr√≥leo, G√°s e Biocombust√≠veis",
    "subsetor": "Explora√ß√£o, Refino e Distribui√ß√£o",
    "cotacao": 31.40,
    "data_ult_cot": "2025-01-23",
    "min_52_sem": 29.66,
    "max_52_sem": 37.60,
    "vol_med_2m": 1488160000,
    "valor_mercado": 404706000000,
    "valor_firma": 730982000000,
    "ult_balanco": "2025-03-31",
    "nro_acoes": 12888700000,
    "oscilacoes": {
      "dia": 0.22,
      "mes": 2.76,
      "dias_30": 1.66,
      "meses_12": -5.01,
      "ano_2025": -11.16,
      "ano_2024": 18.02,
      "ano_2023": 84.43,
      "ano_2022": 46.00,
      "ano_2021": 22.76,
      "ano_2020": -7.68
    },
    "indicadores_fundamentalistas": {
      "pl": 8.41,
      "pvp": 1.02,
      "pebit": 1.92,
      "psr": 0.82,
      "p_ativos": 0.35,
      "p_cap_giro": -8.26,
      "p_ativ_circ_liq": 18.3,
      "div_yield": 3.73,
      "ev_ebitda": 2.61,
      "ev_ebit": 3.48,
      "cres_rec_5a": 11.5,
      "lpa": 3.73,
      "vpa": 30.71,
      "marg_bruta": 49.7,
      "marg_ebit": 42.4,
      "marg_liquida": 9.8,
      "ebit_ativo": 18.3,
      "roic": 19.6,
      "roe": 12.2,
      "liquidez_corr": 0.72,
      "div_br_patrim": 0.94,
      "giro_ativos": 0.43
    },
    "dados_balanco_patrimonial": {
      "ativo": 1147720000000,
      "disponibilidades": 44038000000,
      "ativo_circulante": 124853000000,
      "div_bruta": 370314000000,
      "div_liquida": 326276000000,
      "patrim_liq": 395841000000
    },
    "dados_demonstrativos_resultados": {
      "ultimos_12_meses": {
        "receita_liquida": 496252000000,
        "ebit": 210259000000,
        "lucro_liquido": 48115000000
      },
      "ultimos_3_meses": {
        "receita_liquida": 123144000000,
        "ebit": 51741000000,
        "lucro_liquido": 35209000000
      }
    }
  }
}
```

### üìä M√∫ltiplas A√ß√µes

**POST** `/api/fundamentus/stocks/multiple`

Obt√©m dados de m√∫ltiplas a√ß√µes em uma √∫nica requisi√ß√£o.

```bash
curl -X POST http://localhost:5000/api/fundamentus/stocks/multiple \
  -H "Content-Type: application/json" \
  -d '{
    "symbols": ["PETR4", "VALE3", "ITUB4"],
    "delay": 1.0
  }'
```

**Resposta**:
```json
{
  "success": true,
  "timestamp": "2025-01-27T10:30:00",
  "source": "Fundamentus",
  "summary": {
    "total_requested": 3,
    "successful": 3,
    "failed": 0,
    "success_rate": "100.0%"
  },
  "data": {
    "PETR4": { /* dados completos */ },
    "VALE3": { /* dados completos */ },
    "ITUB4": { /* dados completos */ }
  }
}
```

### üìã Todas as A√ß√µes

**GET** `/api/fundamentus/stocks/all`

Obt√©m resumo de todas as a√ß√µes dispon√≠veis.

```bash
curl http://localhost:5000/api/fundamentus/stocks/all
```

**Par√¢metros**:
- `format`: `json` ou `csv` (padr√£o: json)

```bash
# Baixar como CSV
curl "http://localhost:5000/api/fundamentus/stocks/all?format=csv" -o fundamentus_all.csv
```

### üîç Busca por Crit√©rios

**POST** `/api/fundamentus/stocks/search`

Busca a√ß√µes que atendem a crit√©rios espec√≠ficos.

```bash
curl -X POST http://localhost:5000/api/fundamentus/stocks/search \
  -H "Content-Type: application/json" \
  -d '{
    "criteria": {
      "pl_max": 15,
      "roe_min": 15,
      "div_yield_min": 5,
      "pvp_max": 2,
      "roic_min": 10,
      "marg_liquida_min": 5,
      "ev_ebit_max": 10,
      "liquidez_min": 1000000
    }
  }'
```

**Crit√©rios Dispon√≠veis**:
- `pl_max/pl_min`: P/L m√°ximo/m√≠nimo
- `pvp_max/pvp_min`: P/VP m√°ximo/m√≠nimo
- `roe_max/roe_min`: ROE m√°ximo/m√≠nimo
- `roic_max/roic_min`: ROIC m√°ximo/m√≠nimo
- `div_yield_max/div_yield_min`: Dividend Yield m√°ximo/m√≠nimo
- `marg_liquida_max/marg_liquida_min`: Margem L√≠quida m√°xima/m√≠nima
- `ev_ebit_max/ev_ebit_min`: EV/EBIT m√°ximo/m√≠nimo
- `liquidez_min`: Liquidez m√≠nima

**Resposta**:
```json
{
  "success": true,
  "timestamp": "2025-01-27T10:30:00",
  "source": "Fundamentus",
  "criteria": { /* crit√©rios utilizados */ },
  "total_matches": 25,
  "stocks": ["PETR4", "VALE3", "ITUB4", "..."]
}
```

### üè≠ An√°lise Setorial

**GET** `/api/fundamentus/analysis/sector`

An√°lise estat√≠stica por setor.

```bash
# An√°lise geral
curl http://localhost:5000/api/fundamentus/analysis/sector

# An√°lise de setor espec√≠fico
curl "http://localhost:5000/api/fundamentus/analysis/sector?sector=Bancos"
```

**Resposta**:
```json
{
  "success": true,
  "timestamp": "2025-01-27T10:30:00",
  "source": "Fundamentus",
  "sector": "Todos os setores",
  "analysis": {
    "total_empresas": 450,
    "setores": {
      "Bancos": 25,
      "Petr√≥leo, G√°s e Biocombust√≠veis": 15,
      "Minera√ß√£o": 12
    },
    "estatisticas": {
      "P/L": {
        "media": 12.5,
        "mediana": 10.2,
        "min": 2.1,
        "max": 45.8,
        "std": 8.3
      }
    }
  }
}
```

### üèÜ Rankings

**GET** `/api/fundamentus/stocks/ranking`

Ranking de a√ß√µes por indicador espec√≠fico.

```bash
curl "http://localhost:5000/api/fundamentus/stocks/ranking?indicator=roe&order=desc&limit=10"
```

**Par√¢metros**:
- `indicator`: `pl`, `pvp`, `roe`, `roic`, `div_yield`, `marg_liquida`, `ev_ebit`, `liquidez`
- `order`: `asc`, `desc`, `auto` (padr√£o: auto)
- `limit`: N√∫mero m√°ximo de resultados (padr√£o: 50, m√°ximo: 200)

**Resposta**:
```json
{
  "success": true,
  "timestamp": "2025-01-27T10:30:00",
  "source": "Fundamentus",
  "ranking": {
    "indicator": "roe",
    "indicator_name": "ROE",
    "order": "desc",
    "total_results": 10,
    "data": [
      {
        "rank": 1,
        "papel": "PETR4",
        "empresa": "PETROBRAS PN",
        "setor": "Petr√≥leo, G√°s e Biocombust√≠veis",
        "valor_indicador": 25.8,
        "cotacao": 31.40
      }
    ]
  }
}
```

### ‚öñÔ∏è Compara√ß√£o de A√ß√µes

**POST** `/api/fundamentus/stocks/compare`

Compara indicadores entre m√∫ltiplas a√ß√µes.

```bash
curl -X POST http://localhost:5000/api/fundamentus/stocks/compare \
  -H "Content-Type: application/json" \
  -d '{
    "symbols": ["PETR4", "VALE3", "ITUB4"],
    "indicators": ["pl", "roe", "roic", "div_yield"]
  }'
```

**Resposta**:
```json
{
  "success": true,
  "timestamp": "2025-01-27T10:30:00",
  "source": "Fundamentus",
  "comparison": {
    "symbols": ["PETR4", "VALE3", "ITUB4"],
    "indicators": ["pl", "roe", "roic", "div_yield"],
    "data": { /* dados completos de cada a√ß√£o */ },
    "comparison_table": [
      {
        "indicator": "pl",
        "values": {
          "PETR4": 8.41,
          "VALE3": 12.5,
          "ITUB4": 9.8
        }
      }
    ],
    "statistics": {
      "pl": {
        "min": 8.41,
        "max": 12.5,
        "avg": 10.24,
        "count": 3
      }
    }
  }
}
```

## üêç Uso Direto em Python

### üì¶ Importa√ß√£o

```python
from services.fundamentus_scraper import (
    FundamentusScraper, 
    get_fundamentus_data, 
    get_multiple_fundamentus_data
)
```

### üîç Exemplos de Uso

#### Dados de uma a√ß√£o espec√≠fica

```python
# M√©todo simples
data = get_fundamentus_data("PETR4")
if data:
    print(f"Empresa: {data['empresa']}")
    print(f"P/L: {data['indicadores_fundamentalistas']['pl']}")
    print(f"ROE: {data['indicadores_fundamentalistas']['roe']}%")

# M√©todo com classe
scraper = FundamentusScraper()
stock_data = scraper.get_stock_details("PETR4")
if stock_data:
    print(f"Cota√ß√£o: R$ {stock_data.cotacao}")
    print(f"Dividend Yield: {stock_data.div_yield}%")
```

#### M√∫ltiplas a√ß√µes

```python
symbols = ["PETR4", "VALE3", "ITUB4", "BBDC4"]
results = get_multiple_fundamentus_data(symbols, delay=1.5)

for symbol, data in results.items():
    if data:
        print(f"{symbol}: ROE = {data['indicadores_fundamentalistas']['roe']}%")
    else:
        print(f"{symbol}: Dados n√£o dispon√≠veis")
```

#### Resumo de todas as a√ß√µes

```python
scraper = FundamentusScraper()
df = scraper.get_all_stocks_summary()

if df is not None:
    print(f"Total de a√ß√µes: {len(df)}")
    
    # Top 10 por ROE
    top_roe = df.nlargest(10, 'ROE')
    print("\nTop 10 ROE:")
    print(top_roe[['Papel', 'Empresa', 'ROE']])
    
    # Salvar em CSV
    df.to_csv('fundamentus_all_stocks.csv', index=False)
```

#### Busca por crit√©rios

```python
scraper = FundamentusScraper()

# Crit√©rios para a√ß√µes de valor
criteria = {
    'pl_max': 12,
    'pvp_max': 1.5,
    'roe_min': 15,
    'div_yield_min': 4,
    'liquidez_min': 1000000
}

matching_stocks = scraper.search_stocks(criteria)
if matching_stocks:
    print(f"Encontradas {len(matching_stocks)} a√ß√µes:")
    for stock in matching_stocks:
        print(f"  - {stock}")
```

#### An√°lise setorial

```python
scraper = FundamentusScraper()

# An√°lise geral
analysis = scraper.get_sector_analysis()
if analysis:
    print(f"Total de empresas: {analysis['total_empresas']}")
    print("\nSetores:")
    for setor, count in analysis['setores'].items():
        print(f"  {setor}: {count} empresas")

# An√°lise de setor espec√≠fico
banking_analysis = scraper.get_sector_analysis("Bancos")
if banking_analysis:
    stats = banking_analysis['estatisticas']
    print(f"\nBancos - ROE m√©dio: {stats['ROE']['media']:.2f}%")
```

## üß™ Testes

### üöÄ Executar Testes

```bash
# Todos os testes
python test_fundamentus.py

# Apenas testes diretos (sem API)
python test_fundamentus.py --test direct

# Apenas testes da API
python test_fundamentus.py --test api

# Especificar URL diferente
python test_fundamentus.py --url http://localhost:8000
```

### üìä Relat√≥rio de Testes

Os testes geram um relat√≥rio detalhado em JSON:

```json
{
  "timestamp": "2025-01-27T10:30:00",
  "duration_seconds": 45.2,
  "success_rate": 95.5,
  "total_tests": 22,
  "successful_tests": 21,
  "failed_tests": 1,
  "test_details": { /* detalhes de cada teste */ }
}
```

## ‚ö†Ô∏è Considera√ß√µes Importantes

### üö¶ Rate Limiting

- **Delay recomendado**: 1-2 segundos entre requisi√ß√µes
- **Limite de a√ß√µes simult√¢neas**: M√°ximo 50 por requisi√ß√£o
- **Timeout**: 30-60 segundos para requisi√ß√µes

### üõ°Ô∏è Tratamento de Erros

```python
try:
    data = get_fundamentus_data("PETR4")
    if data is None:
        print("A√ß√£o n√£o encontrada ou dados indispon√≠veis")
except Exception as e:
    print(f"Erro ao obter dados: {str(e)}")
```

### üìù Logs

```python
import logging

# Configurar n√≠vel de log
logging.getLogger('fundamentus-scraper').setLevel(logging.DEBUG)

# Os logs incluem:
# - Requisi√ß√µes realizadas
# - Dados extra√≠dos
# - Erros e warnings
# - Performance
```

### üîÑ Cache

A API implementa cache autom√°tico:
- **Health check**: Sem cache
- **A√ß√£o espec√≠fica**: 5 minutos
- **M√∫ltiplas a√ß√µes**: Sem cache (dados √∫nicos)
- **Todas as a√ß√µes**: 10 minutos
- **Busca/An√°lise**: 15 minutos

## üöÄ Casos de Uso Pr√°ticos

### üìà Screening de A√ß√µes

```python
# Encontrar a√ß√µes baratas com bons fundamentos
criteria = {
    'pl_max': 10,
    'pvp_max': 1.2,
    'roe_min': 20,
    'roic_min': 15,
    'div_yield_min': 6,
    'marg_liquida_min': 10
}

scraper = FundamentusScraper()
candidates = scraper.search_stocks(criteria)

# Obter dados detalhados dos candidatos
if candidates:
    detailed_data = get_multiple_fundamentus_data(candidates[:10])
    
    for symbol, data in detailed_data.items():
        if data:
            print(f"\n{symbol} - {data['empresa']}")
            print(f"  P/L: {data['indicadores_fundamentalistas']['pl']}")
            print(f"  ROE: {data['indicadores_fundamentalistas']['roe']}%")
            print(f"  Div. Yield: {data['indicadores_fundamentalistas']['div_yield']}%")
```

### üìä An√°lise Comparativa

```python
# Comparar bancos
banks = ["ITUB4", "BBDC4", "SANB11", "BPAC11"]
comparison_data = get_multiple_fundamentus_data(banks)

print("Compara√ß√£o de Bancos:")
print("Papel\t\tROE\tP/L\tDiv.Yield")
print("-" * 40)

for symbol, data in comparison_data.items():
    if data:
        roe = data['indicadores_fundamentalistas']['roe']
        pl = data['indicadores_fundamentalistas']['pl']
        dy = data['indicadores_fundamentalistas']['div_yield']
        print(f"{symbol}\t\t{roe:.1f}%\t{pl:.1f}\t{dy:.1f}%")
```

### üìà Monitoramento de Carteira

```python
# Monitorar carteira
portfolio = ["PETR4", "VALE3", "ITUB4", "BBDC4", "WEGE3"]

def monitor_portfolio(symbols):
    data = get_multiple_fundamentus_data(symbols)
    
    print("Status da Carteira:")
    print("=" * 50)
    
    for symbol, stock_data in data.items():
        if stock_data:
            cotacao = stock_data['cotacao']
            var_dia = stock_data['oscilacoes']['dia']
            pl = stock_data['indicadores_fundamentalistas']['pl']
            
            status = "üìà" if var_dia > 0 else "üìâ" if var_dia < 0 else "‚û°Ô∏è"
            
            print(f"{status} {symbol}: R$ {cotacao:.2f} ({var_dia:+.2f}%) - P/L: {pl:.1f}")

monitor_portfolio(portfolio)
```

## üîß Personaliza√ß√£o e Extens√£o

### üéØ Adicionando Novos Indicadores

```python
# Estender a classe FundamentusData
@dataclass
class ExtendedFundamentusData(FundamentusData):
    custom_indicator: float = 0.0
    
# Estender o scraper
class ExtendedFundamentusScraper(FundamentusScraper):
    def _extract_custom_data(self, soup, data):
        # Implementar extra√ß√£o de dados customizados
        pass
```

### üîÑ Integra√ß√£o com Banco de Dados

```python
import sqlite3
import json

def save_to_database(symbol, data):
    conn = sqlite3.connect('fundamentus.db')
    cursor = conn.cursor()
    
    cursor.execute('''
        INSERT OR REPLACE INTO stocks 
        (symbol, data, updated_at) 
        VALUES (?, ?, datetime('now'))
    ''', (symbol, json.dumps(data)))
    
    conn.commit()
    conn.close()

# Uso
data = get_fundamentus_data("PETR4")
if data:
    save_to_database("PETR4", data)
```

## üìû Suporte e Contribui√ß√£o

### üêõ Reportar Problemas

1. Verificar logs detalhados
2. Testar com diferentes a√ß√µes
3. Verificar conectividade com Fundamentus
4. Reportar com dados espec√≠ficos

### ü§ù Contribuir

1. Fork do reposit√≥rio
2. Implementar melhorias
3. Adicionar testes
4. Documentar mudan√ßas
5. Submeter Pull Request

### üìß Contato

Para d√∫vidas t√©cnicas ou sugest√µes, consulte a documenta√ß√£o do projeto principal.

---

**üìä Fundamentus Scraper** - An√°lise fundamentalista profissional para o mercado brasileiro de a√ß√µes. 